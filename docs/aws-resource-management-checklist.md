# AWS Resource Management Verification Checklist

## 📋 Issue #33 - AWS リソース管理スクリプト確認チェックリスト

このチェックリストを使用して、AWS マネジメントコンソールでリソースの停止・開始状態を確認してください。

---

## 🛑 停止状態の確認

### 1. ECS サービス確認

#### アクセス手順
1. AWS マネジメントコンソール → **ECS** サービス
2. 左メニュー → **クラスター**
3. **splitmate-cluster** をクリック
4. **サービス** タブを選択

#### チェック項目 - Backend Service
- [ ] サービス名: `splitmate-backend-service`
- [ ] **ステータス: `アクティブ`** （これは正常）
- [ ] **タスク: `0 件が保留中 | 0 件が実行中`** ← **重要！**
- [ ] **タスク定義: 最新リビジョン表示** (例: `splitmate-backend:12`)
- [ ] **デプロイのステータス: `成功`**

#### チェック項目 - Frontend Service
- [ ] サービス名: `splitmate-frontend-service`
- [ ] **ステータス: `アクティブ`** （これは正常）
- [ ] **タスク: `0 件が保留中 | 0 件が実行中`** ← **重要！**
- [ ] **タスク定義: 最新リビジョン表示** (例: `splitmate-frontend:8`)
- [ ] **デプロイのステータス: `成功`**

### 2. RDS インスタンス確認

#### アクセス手順
1. AWS マネジメントコンソール → **RDS** サービス
2. 左メニュー → **データベース**

#### チェック項目
- [ ] データベース名: `splitmate-mysql`
- [ ] **ステータス: `停止済み` または `停止中`** ← **重要！**
- [ ] エンドポイント: 表示されている（停止中でも保持）

**注意**: RDS停止には数分かかります。`停止中` から `停止済み` に変わるまで待機してください。

### 3. Application Load Balancer 確認

#### アクセス手順
1. AWS マネジメントコンソール → **EC2** サービス
2. 左メニュー → **ロードバランサー**

#### チェック項目
- [ ] ロードバランサー名: `splitmate-alb`
- [ ] **状態: `アクティブ`** （これは正常 - ALBは停止しません）
- [ ] **DNS名: 変更なし** ← **重要！**

**注意**: ALBは停止せず、常時稼働します。ECSサービス停止により、503/502エラーを返すようになります。

### 4. ECR リポジトリ確認

#### アクセス手順
1. AWS マネジメントコンソール → **ECR** サービス
2. **プライベートリポジトリ**

#### チェック項目
- [ ] リポジトリ名: `splitmate-backend` - 存在確認
- [ ] リポジトリ名: `splitmate-frontend` - 存在確認
- [ ] **イメージ: 保持されている** ← **重要！**

**注意**: ECRリポジトリは停止対象外です。イメージは保持されます。

---

## ▶️ 開始状態の確認

### 1. ECS サービス確認

#### チェック項目 - Backend Service
- [ ] サービス名: `splitmate-backend-service`
- [ ] **ステータス: `アクティブ`**
- [ ] **タスク: `0 件が保留中 | 1 件が実行中`** ← **重要！**
- [ ] **タスク定義: 最新リビジョン表示** (例: `splitmate-backend:12`)
- [ ] **デプロイのステータス: `成功`**
- [ ] **ロードバランサーの状態: ターゲットが `1件が正常`**

#### チェック項目 - Frontend Service
- [ ] サービス名: `splitmate-frontend-service`
- [ ] **ステータス: `アクティブ`**
- [ ] **タスク: `0 件が保留中 | 1 件が実行中`** ← **重要！**
- [ ] **タスク定義: 最新リビジョン表示** (例: `splitmate-frontend:8`)
- [ ] **デプロイのステータス: `成功`**
- [ ] **ロードバランサーの状態: ターゲットが `1件が正常`**

**注意**: タスクの起動には2-5分かかる場合があります。

### 2. RDS インスタンス確認

#### チェック項目
- [ ] データベース名: `splitmate-mysql`
- [ ] **ステータス: `利用可能`** ← **重要！**
- [ ] エンドポイント: 変更なし
- [ ] 可用性: `利用可能`

**注意**: RDS開始には5-10分かかる場合があります。

### 3. Application Load Balancer 確認

#### チェック項目
- [ ] ロードバランサー名: `splitmate-alb`
- [ ] 状態: `アクティブ`
- [ ] **ターゲットグループ: ヘルシー** ← **重要！**

### 4. アプリケーション動作確認

#### チェック項目
- [ ] **アプリケーションURL にアクセス可能** ← **最終確認！**
- [ ] ログイン機能が動作
- [ ] データベース接続が正常

**URL**: `http://splitmate-alb-xxxxx.ap-northeast-1.elb.amazonaws.com`

---

## 🚨 トラブルシューティング

### 停止が完了しない場合
- ECS タスクが残っている → 手動で停止
- RDS が停止しない → 接続中のクライアントがある可能性

### 開始が完了しない場合
- ECS タスクが起動しない → ログを確認
- RDS 接続エラー → セキュリティグループ設定を確認
- ALB でエラー → ターゲットグループのヘルスチェック状況を確認

### スクリプト実行時のエラー
- AWS CLI 認証エラー → `aws configure` で設定確認
- 権限エラー → IAM ポリシーを確認

---

## ✅ 確認完了チェック

### 停止テスト完了
- [ ] すべての ECS サービスタスク数が 0
- [ ] RDS インスタンスが停止済み
- [ ] ALB が稼働継続（正常）
- [ ] ECR リポジトリのイメージ保持確認

### 開始テスト完了
- [ ] すべての ECS サービスタスク数が 1 で稼働
- [ ] RDS インスタンスが利用可能
- [ ] ALB のターゲットがヘルシー
- [ ] アプリケーションが正常動作

---

## 📝 Notes

- **コスト削減効果**: 主にECSタスクとRDSインスタンスの停止による
- **データ保持**: RDSデータは停止中も保持され、開始時に復元
- **URL保持**: ALBのDNS名は変更されず、アプリケーションURLが安定
- **起動時間**: 完全復旧まで通常5-10分程度 
